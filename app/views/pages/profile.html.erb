<div class="container" id="user-dashboard">

  <div class="header">
  <% if @user.photo.present?  %>
    <%= cl_image_tag(@user.photo, width: 300, height: 300, crop: :thumb, gravity: :face, radius: :max, class: 'avatar-large')%>
  <% else %>
    <img class="avatar-large" alt="avatar-large" src="https://seedlingsgardening.com/wp-content/uploads/sites/9/2016/11/avatar.jpg" />
  <% end %>
  <div class="header-text">
    <h1><%= @user.nickname %></h1>
    <% if @user == current_user %>
      <%= link_to 'Edit your profile', edit_user_path(@user) %>
    <% else %>
      <p>Discover the dreams of your friend!</p>
    <% end %>
  </div>
</div>

  <h3><strong><%= @user.nickname %>'s</strong> posted dreams:</h3>
<!--If the @user IS the current user (own profile)-->
  <% if @user == current_user %>
<!--Go over @dreams (user.dreams)-->
    <div class="row">
      <div class="col-sm-8 col-md-6 col-lg-4">
          <% @dreams.each do |dream| %>
          <!--First column: display dream image-->
          <div class="card-img">
            <% url = "http://res.cloudinary.com/dl33w8wdg/#{dream.photo.identifier}" %>
            <%= image_tag(url) %>
          </div>
          <div class="card-text">
            <h4><%= dream.title %></h4>
               <!--Second column: if bookings is empty, say there are no bookings-->
              <% if dream.bookings.empty? %>
                <h5>Whoops - this dream hasn't been booked yet.</h5>
              <!--If there are bookings, show the nickname of the bookers and stats-->
              <% else %>
                <%= dream.bookings.each do |booking| %>
                  <p>Booked by:<%= booking.user.nickname %>, on  <%= booking.created_at %>, for <%= booking.date_booking %></p>
                <% end %>
              <% end %>
            <% end %>
        </div>
      </div>


    <!--User's OWN bookings-->

    <h3><strong><%= @user.nickname %>'s</strong> booked dreams:</h3>
     <div class="row">
        <div class="col-sm-8 col-md-6 col-lg-4">
          <!--If Bookings are empty, say there are none-->
         <% if @user.bookings.empty? %>
           <p>Whoops - I still haven't booked any dream :(</p>
         <% end %>

        <!--else, show the user's OWN bookings & update/delete buttons-->
        <% @user.bookings.each do |booking| %>
          <h4><%= booking.dream.title %>, booked on <%= booking.date_booking  %></h4>
        <div class="action-booking">
          <%= link_to 'UPDATE', edit_dream_booking_path(booking.dream, booking), class: 'create-button' %>
          <%= link_to 'DELETE', dream_booking_path(booking.dream, booking),
              method: :delete,
              data: { confirm: "Are you sure?" },
              class: 'create-button' %>
           <% end %>
        </div>
      </div>
    </div>
  
  <!--if @user is NOT!! the current user (someone else's profile)-->
  <% else %>
  
    <!--go over the dreams they posted-->
    <% @dreams.each do |dream| %>
      <div class="row">
        <!--First column: display dream image-->
        <div class="col-sm-8 col-md-6 col-lg-4">
          <% url = "http://res.cloudinary.com/dl33w8wdg/#{dream.photo.identifier}" %>
          <%= image_tag(url) %>
        </div>
        <!--Second column: show title, description, vibe-->
        <div class="col-sm-8 col-md-6 col-lg-4">
          <h4><%= dream.title %></h4>
          <p><%= dream.description %></p>
          <h5>Vibe: <%= dream.vibe %></h5>
        </div>
      </div>
    <% end %>
  <% end %>
</div>
